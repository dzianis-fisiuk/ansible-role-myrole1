---
dist: bionic
sudo: required

language: python
python:
  - "3.8"

services:
  - docker

env:
  - DOCKER_COMPOSE_VERSION="1.29.2"
  - DOCKER_REGISTRY_URL="https://github.com/docker/compose/releases/download"
before_install:
  #- git clone https://github.com/dzianis-fisiuk/ansible-lint-rules.git ~/ansible-lint-rules
  - sudo curl -L "${DOCKER_REGISTRY_URL}/${DOCKER_COMPOSE_VERSION}/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
  - sudo chmod +x /usr/local/bin/docker-compose
  - ls -l /usr/local/bin/docker-compose
install:
  # - pip3 install --upgrade docker
  # - pip3 install ansible-core==2.11.1 ansible-lint==5.0.12 ansible==4.0.0 yamllint==1.26.1
  # - pip3 install molecule==3.3.4 molecule-docker==0.2.4
  # - pip3 install git+https://github.com/ansible/ansible-lint.git
  # - ansible --version
  # - ansible-lint --version
  #- docker-compose -f docker-compose.yml run toolset
  - docker-compose up --build --detach
script:
  docker ps
  docker exec toolset yamllint . -c .yamllint
  docker exec toolset ansible-lint . -c .ansible-lint
  docker exec toolset molecule test -s test-docker
  docker rm -f toolset

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
